<!DOCTYPE html>
<html>

<head>
  <title>wiphat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css">
  <link href="https://fonts.googleapis.com/css?family=Lora" rel="stylesheet">
</head>

<body id="register">
  <div class="row pane" id="welcome">
    <div class="col-xs-12">
      <h2>wiphat</h2>
      <p>wiphat is an anonymous & non-tracking chat platform.</p>
    </div>
  </div>

  <div class="row pane" id="start">
    <h2>let's start</h2>
    <div class="col-md-6 col-md-offset-3 col-xs-10 col-xs-offset-1">
      <span>create a private room</span>
    </div>
  </div>

  <div class="row pane" id="join">
    <h2>join to</h2>
    <div class="col-md-6 col-md-offset-3 col-xs-12">
      <form action="" class="row">
        <label for="room" class="col-md-1 col-md-offset-0 col-xs-1 col-xs-offset-1">#</label>
        <input type="text" id="joinInput" class="focus col-md-9 col-xs-8" maxlength="10" id="joinInput" />
        <span class="col-md-1 col-xs-1" id="joinButton">></span>
      </form>
    </div>
  </div>

  </form>
  <script src="/js/jquery.js"></script>
  <script src="/js/web.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="/js//jquery.cookie.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script>
    $(document).ready(function () {
      // Clear cookies if do not properly exit from previous room
      $.removeCookie('wiphat_username');
      $.removeCookie('wiphat_room');

      var socket = io();

      var userName = makeId(4, true);
      var roomName = makeId(10, false);

      // When the user submits name and room
      $('#start > div').on('click', function () {
        // to avoid confusions, we only accept lowercase names and room names
        var name = userName;
        var room = roomName;

        // Submitted name and room name organized neatly
        var data = {
          name: name,
          room: room
        }

        // Tell the server that a new user has joined, and give it the users name and desired room
        socket.emit('new user', data);

        // Set cookies on the users browser to keep them logged into the room until they sign out or the cookie expires
        $.cookie('wiphat_room', room);
        $.cookie('wiphat_username', name);

        // Redirect the user to the actual chat
        window.location.href = "/chat/" + room;

        return false;
      });

      $('#joinButton').on('click', function () {
        if (/^[a-z0-9]{10}/.test($('#joinInput').val())) {
          var name = userName;
          var room = $('#joinInput').val();

          // Submitted name and room name organized neatly
          var data = {
            name: name,
            room: room
          }

          // Tell the server that a new user has joined, and give it the users name and desired room
          socket.emit('new user', data);

          // Set cookies on the users browser to keep them logged into the room until they sign out or the cookie expires
          $.cookie('wiphat_room', room);
          $.cookie('wiphat_username', name);

          // Redirect the user to the actual chat
          window.location.href = "/chat/" + room;

          return false;
        }
      });

      $('form').submit(function () {
        if (/^[a-z0-9]{10}/.test($('#joinInput').val())) {
          var name = userName;
          var room = $('#joinInput').val();

          // Submitted name and room name organized neatly
          var data = {
            name: name,
            room: room
          }

          // Tell the server that a new user has joined, and give it the users name and desired room
          socket.emit('new user', data);

          // Set cookies on the users browser to keep them logged into the room until they sign out or the cookie expires
          $.cookie('wiphat_room', room);
          $.cookie('wiphat_username', name);

          // Redirect the user to the actual chat
          window.location.href = "/chat/" + room;

          return false;
        }
      });
    });
  </script>
</body>

</html>