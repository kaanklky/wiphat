<!DOCTYPE html>
<html>

<head>
  <title>Wiphat</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="./css/style.css">
  <link href="https://fonts.googleapis.com/css?family=Lora" rel="stylesheet">
</head>

<body id="register">
  <form action="" class="row">

    <!-- Left column, where the user selects a name -->
    <div class="col-md-6 col-sm-12 pane" id="left">
      <h2>Let's Start</h2>
      <div class="col-md-6 col-md-offset-3 col-xs-6 col-xs-offset-3">
        Create a Private Room
      </div>
    </div>

    <!-- Right column, where the user selects a room -->
    <div class="col-md-6 col-sm-12 pane" id="right">
      <h2>Join to</h2>
      <label for="room">#</label>
      <input type="text" id="room" class="focus" maxlength="20" />
      <span>></span>
    </div>

  </form>

  <!-- Footer, currently just shows the name of the project -->
  <div class="row" id="footer">
    <div class="col-xs-12">
      <h2 style="color: #000;">wiphat</h2>
    </div>
  </div>
  <script src="./js/jquery.js"></script>
  <script src="./js/web.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdn.rawgit.com/carhartl/jquery-cookie/master/src/jquery.cookie.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script>
    $(function () {
      // Clear cookies if do not properly exit from previous room
      $.removeCookie('username');
      $.removeCookie('room');

      var socket = io();

      var userName = makeId(4, true);
      var roomName = makeId(10, false);

      // When the user submits name and room
      $('#left > div').on('click', function () {
        // to avoid confusions, we only accept lowercase names and room names
        var name = userName;
        var room = roomName;

        // Submitted name and room name organized neatly
        var data = {
          name: name,
          room: room
        }

        // Tell the server that a new user has joined, and give it the users name and desired room
        socket.emit('new user', data);

        // Set cookies on the users browser to keep them logged into the room until they sign out or the cookie expires
        $.cookie('room', room);
        $.cookie('username', name);

        // Redirect the user to the actual chat
        window.location.href = "/chat/" + room;

        return false;
      });

      $('#right > span').on('click', function () {
        var regex = new RegExp("^[a-zA-Z0-9]+$");

        if (regex.test($('#right > input').val())) {
          var name = userName;
          var room = $('#room').val();

          // Submitted name and room name organized neatly
          var data = {
            name: name,
            room: room
          }

          // Tell the server that a new user has joined, and give it the users name and desired room
          socket.emit('new user', data);

          // Set cookies on the users browser to keep them logged into the room until they sign out or the cookie expires
          $.cookie('room', room);
          $.cookie('username', name);

          // Redirect the user to the actual chat
          window.location.href = "/chat/" + room;

          return false;
        }
      });

      $('form').submit(function() {
        var regex = new RegExp("^[a-zA-Z0-9]+$");

        if (regex.test($('#right > input').val())) {
          var name = userName;
          var room = $('#room').val();

          // Submitted name and room name organized neatly
          var data = {
            name: name,
            room: room
          }

          // Tell the server that a new user has joined, and give it the users name and desired room
          socket.emit('new user', data);

          // Set cookies on the users browser to keep them logged into the room until they sign out or the cookie expires
          $.cookie('room', room);
          $.cookie('username', name);

          // Redirect the user to the actual chat
          window.location.href = "/chat/" + room;

          return false;
        }
      });
    });
  </script>
</body>

</html>